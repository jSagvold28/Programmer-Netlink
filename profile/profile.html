<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="apple-touch-icon" sizes="180x180" href="/favicon.png" />
	<link rel="icon" type="image/png" sizes="32x32" href="/favicon.png" />
	<link rel="icon" type="image/png" sizes="16x16" href="/favicon.png" />
    <link rel="stylesheet" href="style.css">
    <title>Programer Netlink - Profile</title>
</head>
<body>




	  <script> 
		function uploadImage() {
		  const fileInput = document.getElementById('image-upload');
		  fileInput.accept = 'image/jpeg, image/png, image/heic, image b/svg,'; // Add allowed file types here
		
		  fileInput.addEventListener('change', (event) => {
			const file = event.target.files[0];
			const reader = new FileReader();
		
			reader.onload = (e) => {
			  const uploadedImage = document.getElementById('uploaded-image');
			  uploadedImage.style.backgroundImage = `url(${e.target.result})`; // Set the uploaded image as background
			  uploadedImage.style.display = 'block';
		
			  // Save image data to localStorage
			  localStorage.setItem('profileImage', e.target.result);
			}
		
			reader.readAsDataURL(file);
		  });
		
		  fileInput.click();
		
		  // Check if there is no image uploaded
		  const uploadedImage = document.getElementById('uploaded-image');
		  if (!uploadedImage.style.backgroundImage || uploadedImage.style.backgroundImage === 'none') {
			  uploadedImage.style.backgroundImage = 'url(/profile/img/default-user-profile.svg)';
			  uploadedImage.style.display = 'block';
			localStorage.setItem('profileImage', '/	profile/img/default-user-profile.svg');
		  }
		}
		</script>
		
		<div class="main-content">
		  <div class="profile-icon-selector-button">
			<input type="file" id="image-upload" accept="image/jpeg, image/png, image/heic, image/svg+xml" style="display:none;">
			<img id="uploaded-image" src="#" alt="Uploaded Image" style="display:none;">
		  </div>
		</div>		

		<!-- HTML for settings gear -->
		<div class="settings" onclick="toggleSettingsContainer()">
			<img src="/profile/img/gear.png" alt="settings gear image" width="auto" height="32">
		</div>
		
		<!-- HTML for settings container -->
		<div class="settings-container" id="settings-container" style="display: none;">
			<div class="modal-overlay">
			<div class="modal-container">
				<div class="modal-header">

					<div class="close">
						<h3>X</h3>
					</div>

					<div class="settings-head">
						<h2>Profile Quick Settings</h2>
					</div>

					<button class="selector-button" onclick="uploadImage()">Add Profile Image</button>

					<div class="container">
						<h3>Add a Skill:</h3>
						<form id="skills-form">
				
					  <label for="new-skill">Skill Name:</label>
					  <input type="text" id="new-skill" name="new-skill" placeholder="name of the skill" minlength="2" max="20">
				
					  <label for="skill-type">Skill Type:</label>
					  <input type="text" id="skill-type" name="new-skill" placeholder="type of the skill that you have" minlength="2" max="15">
				
					  <label for="skill-description">Skill Description:</label>
					  <input type="text" id="skill-description" name="skill-description" placeholder="short breif description" minlength="5" maxlength="25">
				
					  <button type="submit">Add Skill</button>
						</form>
					</div>

					<div class="redirector">
						<a href="http://127.0.0.1:5500/profile/settings/profile-settings.html" target="_blank">Account Settings</a>
					</div>
			
				</div>
			
			</div>
			</div>
		</div>
		
		<script>
			function toggleSettingsContainer() {
			var container = document.getElementById("settings-container");
			if (container.style.display === "none") {
				container.style.display = "block";
			} else {
				container.style.display = "none";
			}
			}
		</script>
  

			<div class="info">
				<h3><span id="signup-name"></span></h3>
				<h3><span id="user-username"></span></h3>
				<h4><span id="tag"></span></h4>
				<h4><span id="likes"></span></h4>
				
				<script>
				  // Load user name and tag from local storage
				  const savedName = localStorage.getItem('signup-name') || '';
				  const savedUserName = localStorage.getItem('username') || '';
				  const savedTag = localStorage.getItem('tag') || '';
			  
				  // Update the user name and tag elements with the saved values
				  const nameElement = document.getElementById('signup-name');
				  nameElement.textContent = savedName;
			  
				  const userNameElement = document.getElementById('user-username');
				  userNameElement.textContent = `@${savedUserName}.${savedTag}.pr`;
			  
				  const tagElement = document.getElementById('tag');
				  tagElement.textContent = `#${savedTag}`;

				  if (storedUsername) {
					usernameElem.textContent = `@${storedUsername} `;
				  } else {
					// usernameElem.textContent = 'No username found in local storage';
				  }
				</script>
			  </div>
	

	  </div>

  <!-- <div class="user-post-header">
    <h2>snpits <span id="user-name"></span></h2>
    <p>Snippits are like 'posts'.</p>
  </div> -->


<div>
	<p id="description-text"></p>
	<button id="create-description-btn">Update Bio</button>
  </div>
  
  <div id="description-modal" style="display: none">
	<label for="new-description">Updated Bio:</label>
	<input type="text" id="new-description">
	<button id="save-description-btn">Update Bio</button>
	<button id="cancel-description-btn">Close</button>
  </div>
  
  <script>
const descriptionText = document.getElementById("description-text");
const createDescriptionBtn = document.getElementById("create-description-btn");
const descriptionModal = document.getElementById("description-modal");
const saveDescriptionBtn = document.getElementById("save-description-btn");
const cancelDescriptionBtn = document.getElementById("cancel-description-btn");
const maxChars = 150;

// Load description from local storage
const description = localStorage.getItem("description");
if (description) {
descriptionText.textContent = description;
}

// Open description modal
createDescriptionBtn.addEventListener("click", () => {
descriptionModal.style.display = "block";
document.getElementById("new-description").value = description || "";
});

// Save description
saveDescriptionBtn.addEventListener("click", () => {
const newDescription = document.getElementById("new-description").value;
const charCount = newDescription.length;

if (charCount > 150) {
alert(`Description exceeds maximum length by ${charCount - 150} characters. The description character length needs to be 150 characters`);
} else {
localStorage.setItem("description", newDescription);
descriptionText.textContent = newDescription;
descriptionModal.style.display = "none";
}
});

// Cancel editing description
cancelDescriptionBtn.addEventListener("click", () => {
descriptionModal.style.display = "none";
});

// Edit description
descriptionText.addEventListener("click", () => {
descriptionModal.style.display = "block";
document.getElementById("new-description").value = descriptionText.textContent || "";
});

// Add new line when Enter key is pressed
descriptionText.addEventListener("keydown", (event) => {
if (event.key === "Enter") {
event.preventDefault();
let currentText = descriptionText.value;
const cursorPosition = descriptionText.selectionStart;
currentText = currentText.substring(0, cursorPosition) + "\n" + currentText.substring(cursorPosition);
descriptionText.value = currentText;
}
});


  </script>
</div>



<div class="tab">
	<button class="tablinks" onclick="openCity(event, 'Snippets')">Snippets</button>
	<button class="tablinks" onclick="openCity(event, 'Articles')">Articles</button>
	<button class="tablinks" onclick="openCity(event, 'Experience')">Experience</button>
  </div>

  <div id="Snippets" class="tabcontent">
	<form></form>
	<div id="user-created-snippets" class="user-created-snippets"></div>
  
	<script>
	  const form = document.querySelector('form');
	  const postsContainer = document.getElementById('user-created-snippets');
  
	  // Check if name exists in local storage
	  let name = localStorage.getItem('name');
	  if (!name) {
		// If not, prompt the user for their name and store it in local storage
		name = prompt('Please enter your name:');
		localStorage.setItem('name', name);
	  }
  
	  // Update the page title to include the user's name
	  document.title = `${name}'s Social Media App`;
  
	  // Load existing posts from local storage
	  const savedPosts = JSON.parse(localStorage.getItem('posts')) || [];
  
	  // Render existing posts
	  if (savedPosts.length) {
		for (let i = savedPosts.length - 1; i >= 0; i--) {
		  const post = savedPosts[i];
  
		  // Create a new post element
		  const postElement = document.createElement('div');
		  postElement.classList.add('post');
		  const author = localStorage.getItem('signup-name');
		  postElement.innerHTML = `
			<h2><span id="author">${author}</span></h2>
			<h2>${post.title}</h2>
			<h4>${post.tags}</h4>
			<div class="interact">
			  <button id="bookmark-button" class="bookmark-button" type="button">Bookmark</button>
			  <div class="follower-class">
				<p>Total Profile Follows: <span id="follower-count">0</span></p>
			  </div>
			  <button id="follow-button">Follow</button>
			  <button id="unfollow-button" style="display:none">Unfollow</button>
			</div>
		  `;
  
		  // Add the new post to the top of the list
		  postsContainer.prepend(postElement);
  
		  // Attach click event listener to bookmark button
		  const bookmarkButton = postElement.querySelector('.bookmark-button');
		  bookmarkButton.addEventListener('click', function() {
			// Retrieve existing bookmarks from localStorage or initialize an empty array
			const bookmarks = JSON.parse(localStorage.getItem('bookmarks')) || [];
  
			// Check if the post is already bookmarked
			const bookmarkIndex = bookmarks.findIndex(bookmark => bookmark.title === post.title);
			if (bookmarkIndex !== -1) {
			  // Post is already bookmarked, so remove it
			  bookmarks.splice(bookmarkIndex, 1);
			  console.log('Removed ' + post.title + ' from post bookmarks.');
			} else {
			  // Post is not bookmarked, so add it
			  bookmarks.push(post);
			  console.log('Added ' + post.title + ' to post bookmarks.');
			}
  
			// Save the updated bookmarks array to localStorage
			localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
		  });
		}
	  }

const noPostsMessage = document.getElementById('no-posts-message');


// Render existing posts
let numPostsShown = 0;
const maxPostsToShow = 5;

function renderPosts() {
  const endIndex = Math.min(numPostsShown + maxPostsToShow, savedPosts.length);

  if (endIndex === 0) {
	var text = 'There are no posts created by ' + savedName;

	element.innerHTML = text
    noPostsMessage.style.display = 'block';
  } else {
    // Hide the no posts message
    noPostsMessage.style.display = 'none';

    for (let i = numPostsShown; i < endIndex; i++) {
      const post = savedPosts[i];

      // Create a new post element
      const postElement = document.createElement('div');
      postElement.classList.add('post');
      // Render the content of the post element
      // ...

      // Add the new post to the container
      postsContainer.appendChild(postElement);

      numPostsShown++;
    }
  }

  // Hide the "Load More" button if all posts have been shown
  if (numPostsShown >= savedPosts.length) {
    loadMoreButton.style.display = 'none';
  }
}


renderPosts();

	</script>

<div id="end-message">
	<script>
      // JavaScript code to display savedName at the end
      document.addEventListener("DOMContentLoaded", function() {

        var endMessage = document.getElementById("end-message");
        endMessage.innerHTML +=
          "<h3>You have reached the end of the Snippets created by " +
          savedName + '.'
          "</h3>";
      });
	</script>
</div>

</div>
  </div>

  <div id="Articles" class="tabcontent">
	<div id="user-created-articles" class="user-created-articles"></div>
  </div>

  <div id="Experience" class="tabcontent">
	  <div id="user-experiences" class="user-experiences"></div>
</div>


  <div class="skills-header">
	<h2>Skills:</h2>

	

  <ul id="skills-list"></ul>
  <script>
const skillsForm = document.querySelector('#skills-form');
const skillsList = document.querySelector('#skills-list');
let skillsArray = JSON.parse(localStorage.getItem('skills')) || [];

// Function to render skills 
function renderSkills() {
  skillsList.innerHTML = '';
  for (let i = 0; i < skillsArray.length; i++) {
    const skillItem = document.createElement('li');
    const skillName = document.createElement('span');
    skillName.textContent = skillsArray[i].name;
    const skillType = document.createElement('span');
    skillType.textContent = skillsArray[i].type;
    const skillDescription = document.createElement('span');
    skillDescription.textContent = skillsArray[i].description;

    // add comma and space between spans
    const comma = document.createTextNode(', ');
    skillItem.appendChild(skillName);
    skillItem.appendChild(comma);
    skillItem.appendChild(skillType);
    skillItem.appendChild(comma.cloneNode());
    skillItem.appendChild(skillDescription);

    skillsList.appendChild(skillItem);
  }
}


// Function to handle form submission
function handleFormSubmit(event) {
  event.preventDefault();
  const skillInput = document.querySelector('#new-skill');
  const skillValue = skillInput.value.trim();
  const skillTypeInput = document.querySelector('#skill-type');
  const skillTypeValue = skillTypeInput.value.trim();
  const skillDescriptionInput = document.querySelector('#skill-description');
  const skillDescriptionValue = skillDescriptionInput.value.trim();
  if (skillValue && skillTypeValue && skillDescriptionValue) {
    const skillObj = { name: skillValue, type: skillTypeValue, description: skillDescriptionValue };
    skillsArray.push(skillObj);
    localStorage.setItem('skills', JSON.stringify(skillsArray));
    skillInput.value = '';
    skillTypeInput.value = '';
    skillDescriptionInput.value = '';
    renderSkills();
  }
}

// Attach event listeners
skillsForm.addEventListener('submit', handleFormSubmit);

// Render initial skills
renderSkills();

  </script>


  <div class="profile-settings-renav">
	<a href="http://127.0.0.1:5500/profile/settings/profile-settings.html">Go to Profile Settings</a>
  </div>

</body>
<script src="script.js"></script>
<script src="tabs.js"></script>
<scirpt src="displayContent.js"></scirpt>
</html>
